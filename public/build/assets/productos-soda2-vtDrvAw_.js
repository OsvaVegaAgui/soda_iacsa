document.addEventListener("DOMContentLoaded",()=>{const d=document.getElementById("mensaje"),e=(a="info",o="")=>{d&&(d.className=`alert alert-${a}`,d.innerHTML=`<strong>${{success:"Éxito",danger:"Error",warning:"Atención",info:"Información"}[a]||"Info"}</strong> ${o}`,d.style.display="",setTimeout(()=>d.style.display="none",3500))},u=document.querySelector("#formCrearProducto");u&&u.addEventListener("submit",async a=>{var c;a.preventDefault();const o=new FormData(u);try{const r=await fetch(u.action,{method:"POST",body:o,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"});if(r.status===422){const s=await r.json(),t=((c=Object.values(s.errors||{})[0])==null?void 0:c[0])||"Revisa los campos del formulario.";typeof e=="function"?e("danger",t):alert(t);return}if(!r.ok){typeof e=="function"&&e("danger","Error al enviar el formulario.");return}const i=await r.json();i.ok||i.success?(typeof e=="function"&&e("success",i.message||"Producto guardado correctamente."),i.redirect&&setTimeout(()=>{window.location.href=i.redirect},1e3)):typeof e=="function"&&e("warning","Solicitud procesada, pero sin confirmación explícita.")}catch(r){console.error(r),typeof e=="function"&&e("danger","Error de conexión. Intenta nuevamente.")}});const l=document.getElementById("formEditarProducto");l&&l.addEventListener("submit",async a=>{var r,i,s;if(a.preventDefault(),!l.checkValidity()){l.reportValidity();return}const o=new FormData(l),c=((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.content)||((i=document.querySelector('input[name="_token"]'))==null?void 0:i.value)||"";try{const t=await fetch(formEditarProducto.action,{method:"POST",body:o,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":c},credentials:"same-origin"});if(t.status===422){const f=await t.json(),m=((s=Object.values(f.errors||{})[0])==null?void 0:s[0])||"Revisa los campos del formulario.";typeof e=="function"?e("danger",m):alert(m);return}if(!t.ok){typeof e=="function"?e("danger","Error al actualizar el producto."):alert("Error al actualizar el producto.");return}const n=await t.json();n.ok?(typeof e=="function"?e("success",n.message||"Producto actualizado correctamente."):alert(n.message||"Producto actualizado correctamente."),n.redirect&&(window.location.href=n.redirect)):typeof e=="function"?e("warning","Solicitud procesada, pero sin confirmación explícita."):alert("Solicitud procesada, pero sin confirmación explícita.")}catch(t){console.error(t),typeof e=="function"?e("danger","Error de conexión. Intenta nuevamente."):alert("Error de conexión. Intenta nuevamente.")}}),document.addEventListener("submit",async a=>{const o=a.target.closest(".form-eliminar-producto");if(o){a.preventDefault();const c=o.querySelector(".btn-eliminar-producto"),r=(c==null?void 0:c.dataset.nombre)||"este producto";if(!confirm(`¿Seguro que desea eliminar ${r}?`))return;const s=new FormData(o);try{const t=await fetch(o.action,{method:"POST",body:s,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"});if(!t.ok){typeof e=="function"?e("danger","No se pudo eliminar el producto."):alert("No se pudo eliminar el producto.");return}const n=await t.json();if(n.ok){typeof e=="function"?(e("success",n.message||"Producto eliminado correctamente."),location.reload()):(alert(n.message||"Producto eliminado correctamente."),location.reload());const f=o.closest("tr");f&&f.remove()}else typeof e=="function"?e("warning",n.message||"No se pudo eliminar el producto."):alert(n.message||"No se pudo eliminar el producto.")}catch(t){console.error(t),typeof e=="function"?e("danger","Error de conexión al intentar eliminar el producto."):alert("Error de conexión al intentar eliminar el producto.")}}})});
